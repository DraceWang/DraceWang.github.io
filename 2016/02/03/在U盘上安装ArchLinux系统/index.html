<!DOCTYPE html>
<html class="full-height">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="//cdn.bootcss.com/bulma/0.4.1/css/bulma.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  
  <title>在U盘上安装ArchLinux系统 | Hexagon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在U盘上安装ArchLinux系统其实在U盘上安装Linux系统基本都能装,也有针对U盘设计的系统像puppy之类的,选Arch主要是个人喜好,还有就是它的安装是手动的,不仅能学到不少linux的知识,也能更好的去适配不同的电脑,arch的可定制化程度非常高,所以更加的灵活也能适应更多的人去使用 0.准备工作0.1U盘要装系统U盘不能太差,我要求比较高,U盘建议16G以上,高速读写不用说最好10">
<meta property="og:type" content="article">
<meta property="og:title" content="在U盘上安装ArchLinux系统">
<meta property="og:url" content="http://dracewang.github.io/2016/02/03/%E5%9C%A8U%E7%9B%98%E4%B8%8A%E5%AE%89%E8%A3%85ArchLinux%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="Hexagon">
<meta property="og:description" content="在U盘上安装ArchLinux系统其实在U盘上安装Linux系统基本都能装,也有针对U盘设计的系统像puppy之类的,选Arch主要是个人喜好,还有就是它的安装是手动的,不仅能学到不少linux的知识,也能更好的去适配不同的电脑,arch的可定制化程度非常高,所以更加的灵活也能适应更多的人去使用 0.准备工作0.1U盘要装系统U盘不能太差,我要求比较高,U盘建议16G以上,高速读写不用说最好10">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/10/27/ILDuA268Vd9T4Ux.jpg">
<meta property="article:published_time" content="2016-02-03T16:00:00.000Z">
<meta property="article:modified_time" content="2023-10-07T03:06:09.513Z">
<meta property="article:author" content="Drace Wang">
<meta property="article:tag" content="archlinux">
<meta property="article:tag" content="mobile system">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/10/27/ILDuA268Vd9T4Ux.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexagon" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/me.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/css/nav.css">
<link rel="stylesheet" href="/css/layout.css">


  <title>Valine - A simple comment system based on Leancloud.</title>
  <!--Leancloud 操作库:-->
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <!--Valine 的核心代码库:-->
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <header id="navbar" class="overflow-hidden">
  <div class="container">
    <nav class="nav">
         <div class="nav-left">
            <a href="/" class="nav-item" style="font-size: 20px;">
              <span class="logo">Drace Wang</span>'s Blog
            </a>
         </div>
        <div class="nav-center is-hidden position-relative" id="search_container">
            <div class="nav-item full-width full-height">
                <i class="fa fa-search has-padding" aria-hidden="true"></i>
                <input type="text" id="search_input" class="search-input full-height full-width" placeholder="Search post" autofocus>
                <i id="close_search" class="fa fa-times" aria-hidden="true"></i>
            </div>
            <div id="search_result"></div>
        </div>
        <div class="nav-right nav-menu">
            <a class="nav-item" id="search">
                <i class="fa fa-search" aria-hidden="true"></i>
            </a>
            
            <a class="nav-item" href="/">
                Home
            </a>
            
            <a class="nav-item" href="/archives">
                Archives
            </a>
            
            <a class="nav-item" href="/about">
                About
            </a>
            
        </div>
        <span class="nav-toggle" id="navMenuDropdown">
            <span></span>
            <span></span>
            <span></span>
        </span>
        <div class="navbar-menu position-absolute full-width content-box is-hidden-desktop is-flex flex-column center" style="top: 100%;">
            
            <a class="nav-item flex-1" href="/">
                Home
            </a>
            
            <a class="nav-item flex-1" href="/archives">
                Archives
            </a>
            
            <a class="nav-item flex-1" href="/about">
                About
            </a>
            
        </div>
    </nav>
  </div>
</header>

  <div id="main-wrap" class="position-relative" style="margin-top: 55px;">
      <div class="main-inner-content">
          <!--博文页面-->

<style>
    .header-box {
        height: 370px;
        filter: blur(10px);
        background-size: cover;
        background-color: lightsteelblue;
    }

    .post-box {
        padding: 15px;
        padding-top: 60px;
        min-height: 80vh;
        margin-top: -200px;
        border-radius: 4px;
        background-color: rgba(255,255,255,.8);
    }

    .post-avatar {
        height: 30px;
        width: 30px;
        border-radius: 50%;
    }

    .flow-chart {
        text-align: center;
    }

    img[alt="post-cover"] {
        display: none;
    }
</style>
<header>
    <div id="header_box" class="header-box"></div>
</header>
<section>
    <div class="container post-box">
        <div class="content post-title is-flex center flex-column" style="margin-bottom: 70px; overflow: auto;">
            <h1 class="has-text-centered" style="padding-bottom: 10px; border-bottom: 3px solid #fff">
                <strong>在U盘上安装ArchLinux系统</strong>
            </h1>
            
            <div class="is-flex align-center">
                <img class="post-avatar" src="images/me.jpg" alt="favicon">
                <span style="padding:0 10px;"> <span class="sub-title">By</span> Drace Wang</span>
                <span class="post-date sub-title">at: 2016-02-03</span>
            </div>
            
                <div>
                    
                         <a class="tag is-post-tag" href="/tags/archlinux/">archlinux</a>
                    
                         <a class="tag is-post-tag" href="/tags/mobile-system/">mobile system</a>
                    
                </div>
            
        </div>
        <div class="content" style="overflow: auto">
            <p><img src="https://i.loli.net/2020/10/27/ILDuA268Vd9T4Ux.jpg" alt="post-cover"></p>
<p>在U盘上安装ArchLinux系统<br>其实在U盘上安装Linux系统基本都能装,也有针对U盘设计的系统像puppy之类的,选Arch主要是个人喜好,还有就是它的安装是手动的,不仅能学到不少linux的知识,也能更好的去适配不同的电脑,arch的可定制化程度非常高,所以更加的灵活也能适应更多的人去使用</p>
<h2 id="0-准备工作"><a href="#0-准备工作" class="headerlink" title="0.准备工作"></a>0.准备工作</h2><h3 id="0-1U盘"><a href="#0-1U盘" class="headerlink" title="0.1U盘"></a>0.1U盘</h3><p>要装系统U盘不能太差,我要求比较高,U盘建议16G以上,高速读写不用说最好100m&#x2F;s以上,4K性能不能忽略(别问我为什么知道,到时候你发现几百大洋买回的U盘用的很不爽别来找我),SanDisk至尊系列亲测还行,如果你们能买到OWC的envy Pro mini最好,这是我到目前为止看的觉得最好的,但是我没有用过,4k性能不知道</p>
<h3 id="0-2ArchLinux安装镜像"><a href="#0-2ArchLinux安装镜像" class="headerlink" title="0.2ArchLinux安装镜像"></a>0.2ArchLinux安装镜像</h3><p>ArchLinux官方网站<br>自己下载最新的镜像,以下步骤为2016年1月尝试实践记录,请参考wikiArchLinux官方安装指导自行对比</p>
<p>ArchLinux的wiki非常丰富,要养成自行查找,解决问题的好习惯(说给自己听的)</p>
<h3 id="0-3找个安装环境——VMware"><a href="#0-3找个安装环境——VMware" class="headerlink" title="0.3找个安装环境——VMware"></a>0.3找个安装环境——VMware</h3><p>安装到U盘的确可以直接用实体机启动,但是做live盘要多用一个U盘或者cd,还有很大的可能会不小心格错盘,导致追悔莫及,所以利用虚拟机安装方便快捷,VMware的安装教程自行寻找,用VirtualBox的也可以参考</p>
<h2 id="1-安装ArchLinux"><a href="#1-安装ArchLinux" class="headerlink" title="1.安装ArchLinux"></a>1.安装ArchLinux</h2><p>新建虚拟机,然后选择ArchLinux安装镜像启动,插上U盘,将U盘挂载到虚拟机中</p>
<h3 id="1-1分区"><a href="#1-1分区" class="headerlink" title="1.1分区"></a>1.1分区</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure>
<p>查看U盘是否挂载上去,不出意外的话,应该会是出现在<code>/dev/sdb</code>检查容量大小是否一致(以下就认为U盘挂载在<code>/dev/sdb</code>)</p>
<p><a target="_blank" rel="noopener" href="https://tldp.org/HOWTO/Partition/fdisk_partitioning.html">fdisk</a> — Linux 自带的命令行分区工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line">#建立boot区</span><br><span class="line"></span><br><span class="line">–&gt;n p 4096 +512M</span><br><span class="line"></span><br><span class="line">#建立根目录/区</span><br><span class="line"></span><br><span class="line">–&gt; n p enter enter</span><br><span class="line"></span><br><span class="line">#查看分区表</span><br><span class="line"></span><br><span class="line">–&gt; p</span><br><span class="line"></span><br><span class="line">#将分区表写入U盘</span><br><span class="line"></span><br><span class="line">–&gt; w</span><br></pre></td></tr></table></figure>
<p>cfdisk — 使用 ncurses 库编写的具有伪图形界面的命令行分区工具<br><a target="_blank" rel="noopener" href="https://www.kernel.org/">https://www.kernel.org/</a><br>警告: cfdisk 创建的第一个分区起始位置是63扇区而不是通常的2048扇区这将会在 SSD 和使用高级格式化(4k 扇区)的设备上造成性能问题<br>GRUB2 也会受影响GRUB legacy 和 Syslinux不受影响<br>gdisk — GPT 版的 fdisk<br><a target="_blank" rel="noopener" href="http://www.rodsbooks.com/gdisk/">http://www.rodsbooks.com/gdisk/</a><br>cgdisk — GPT 版的 cfdisk<br><a target="_blank" rel="noopener" href="http://www.rodsbooks.com/gdisk/">http://www.rodsbooks.com/gdisk/</a><br>sgdisk — Scriptable version of gdisk.<br><a target="_blank" rel="noopener" href="http://www.rodsbooks.com/gdisk/sgdisk-walkthrough.html">http://www.rodsbooks.com/gdisk/sgdisk-walkthrough.html</a><br>GNU Parted — 命令行分区工具<br><a target="_blank" rel="noopener" href="http://www.gnu.org/software/parted/parted.html">http://www.gnu.org/software/parted/parted.html</a><br>GParted — GTK 图形界面的分区工具<br><a target="_blank" rel="noopener" href="http://gparted.sourceforge.net/">http://gparted.sourceforge.net/</a><br>Partitionmanager — QT 图形界面的分区工具<br><a target="_blank" rel="noopener" href="http://sourceforge.net/projects/partitionman/">http://sourceforge.net/projects/partitionman/</a><br>QtParted — 与 Partitionmanager 类似,在 AUR 中可获取<br><a target="_blank" rel="noopener" href="http://qtparted.sourceforge.net/">http://qtparted.sourceforge.net/</a></p>
<h3 id="1-2格式化U盘建立文件系统"><a href="#1-2格式化U盘建立文件系统" class="headerlink" title="1.2格式化U盘建立文件系统"></a>1.2格式化U盘建立文件系统</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/sdb1</span><br><span class="line">以ext4格式,格式化sdb1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkfs.ext4 /dev/sdb2</span><br><span class="line">以ext4格式,格式化sdb2</span><br></pre></td></tr></table></figure>
<h3 id="1-3联网"><a href="#1-3联网" class="headerlink" title="1.3联网"></a>1.3联网</h3><ol>
<li>首先ping baidu.com如果能ping通说明已经联网了,就跳过这一部分</li>
<li>ping 8.8.8.8或者ping 114.114.114.114能ping通说明Dns解析服务器有问题编辑这个文件<code>/etc/resolv.conf</code></li>
<li>以上两步都不行的话,先查服务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl --type=service</span><br></pre></td></tr></table></figure>
<p>看看有没有fail的项,如果有就需要重启这项服务<br>比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop dhcpcd@enp2s0.service</span><br></pre></td></tr></table></figure>
<p>先停止服务再重启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart dhcpcd@enp2s0.service</span><br></pre></td></tr></table></figure>
<p>这里失败是会有日志的,你可以<br>4. 一般的话这样就可以了,如果还不行,请换网络配置(例如虚拟机桥接网络的,改成NAT),一般虚拟机模拟出来的网卡之类的,不会有这些问题</p>
<h3 id="1-4驱动"><a href="#1-4驱动" class="headerlink" title="1.4驱动"></a>1.4驱动</h3><p>接下来说说驱动的事,ArchLinux开机会启动udev来检测驱动等,并在启动时自动载入必要的模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci</span><br></pre></td></tr></table></figure>
<p>可以查看所有pci借口上的硬件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci |grep Ethernet</span><br></pre></td></tr></table></figure>
<p>会输出类似</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">02:00.0 Ethernet controller: Attansic Technology Corp. L1 Gigabit Ethernet Adapter (rev b0)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -s 02:00.0 -v</span><br></pre></td></tr></table></figure>
<p>查看02:00.0总线上的详细信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">02:00.0 Ethernet controller: Attansic Technology Corp. L1 Gigabit Ethernet Adapter (rev b0)</span><br><span class="line">…</span><br><span class="line">Kernel driver in use: atl1</span><br><span class="line">Kernel modules: atl1</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep module_name</span><br></pre></td></tr></table></figure>
<p>会告诉你是否驱动加载成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg |grep atl1</span><br><span class="line">…</span><br><span class="line">atl1 0000:02:00.0: eth0 link is up 100 Mbps full duplex</span><br></pre></td></tr></table></figure>
<p>没有驱动当然要装驱动啦,你问我怎么装？我很严肃的告诉你！要联网！这就是为啥用虚拟机装的事了,虚拟机一般虚拟出来的硬件,在ArchLinux的基本驱动都能通用,你要是你的电脑的网卡正好是Atheros AR8161 Gigabit和我一样,恭喜你,你联网一会儿就会断,根本不能好好玩耍,我到现在都没能整明白为啥,但是wiki上这个网卡有收录,告诉你要加载alx模块,可是我编译不通过,这个以后解决这个问题,暂时先跳过</p>
<h4 id="1-4-1网络部分的一些小命令"><a href="#1-4-1网络部分的一些小命令" class="headerlink" title="1.4.1网络部分的一些小命令"></a>1.4.1网络部分的一些小命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ip addr 查看现有网络连接及ip地址(这里查出来的会有个自动命名的名字比如enp2s0下面的***就应该用这个名字代替)</span><br><span class="line">ip link 查看现有网络连接</span><br><span class="line">ip link set *** up 设置***连接网络</span><br><span class="line">ip link set *** down 设置***断网</span><br><span class="line">dhcpcd *** 使***启动dhcp服务</span><br><span class="line">ls /sys/class/net 查看现有网络接口名字</span><br><span class="line">dhcpcd -k 释放dhcp获得的IP地址</span><br><span class="line">systemctl status dhcpcd@enp2s0.service 查看enp2s0的dhcp服务状态</span><br><span class="line">systemctl --type=service 查看系统已启动的服务</span><br></pre></td></tr></table></figure>
<p>目前就学了这些,欢迎补充</p>
<h3 id="1-5挂载分区"><a href="#1-5挂载分区" class="headerlink" title="1.5挂载分区"></a>1.5挂载分区</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdb2 /mnt</span><br></pre></td></tr></table></figure>
<p>(挂载sdb2 到 &#x2F;mnt)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mnt/boot</span><br></pre></td></tr></table></figure>
<p>(在mnt目录下创建boot目录)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdb1 /mnt/boot</span><br></pre></td></tr></table></figure>
<p>(挂载sdb1 到 &#x2F;mnt&#x2F;boot)</p>
<p>如果有建立了&#x2F;home等目录的同理</p>
<p>如果想要用swap 请参考<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Swap_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">wiki–swap</a></p>
<h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2.安装"></a>2.安装</h2><p>在确认联网的情况下,就可以安装了,不过在真正安装前,选择快速的镜像源很重要,国内163和清华的比较快</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure>
<p>按ctrl+K删除整行,去掉别的,就留163的和清华的即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacstrap -i /mnt base base-devel</span><br></pre></td></tr></table></figure>
<p>安装系统,默认全装</p>
<blockquote>
<p>–&gt;enter –&gt;enter –&gt;Y</p>
</blockquote>
<p>等待安装完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab</span><br></pre></td></tr></table></figure>
<p>生成fstab</p>
<p>设置新系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch-chroot /mnt</span><br></pre></td></tr></table></figure>
<p>转入新系统中,这样就在我们新安装好的系统中进行操作了,可以看到root@archiso变为sh4.3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/locale.gen</span><br></pre></td></tr></table></figure>
<p>选择文字编码,找到en_US.UTF-8 UTF-8和zh开头的都打开注释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locale-gen</span><br></pre></td></tr></table></figure>
<p>更新文字编码系统<br>在 <code>/etc/locale.conf</code> 里设置系统locale偏好；单个用户请设置<code>$HOME/.config/locale.conf</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># echo LANG=zh_CN.UTF8 &gt; /etc/locale.conf</span><br><span class="line"></span><br><span class="line">ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>
<p>对于国内的基本可以用上海时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hwclock --systohc</span><br></pre></td></tr></table></figure>
<p>应该可以同步时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo **** &gt; /etc/hostname</span><br></pre></td></tr></table></figure>
<p>设置主机名****</p>
<h3 id="2-1设置U盘启动"><a href="#2-1设置U盘启动" class="headerlink" title="2.1设置U盘启动"></a>2.1设置U盘启动</h3><p>这个很重要,为了启动后能首先加载usb</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/mkinitcpio.conf</span><br></pre></td></tr></table></figure>
<p>在udev 后面加入usb</p>
<blockquote>
<p>HOOKS&#x3D;”base udev usb autodetect modconf block filesystems keyboard fsck”</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkinitcpio -p linux</span><br></pre></td></tr></table></figure>
<p>重新初始化内存盘</p>
<h3 id="2-2安装引导程序"><a href="#2-2安装引导程序" class="headerlink" title="2.2安装引导程序"></a>2.2安装引导程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S syslinux gptfdisk</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1安装syslinux"><a href="#2-2-1安装syslinux" class="headerlink" title="2.2.1安装syslinux"></a>2.2.1安装syslinux</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syslinux-install_update –iam</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2安装引导项"><a href="#2-2-2安装引导项" class="headerlink" title="2.2.2安装引导项"></a>2.2.2安装引导项</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blkid</span><br></pre></td></tr></table></figure>
<p>查看UUID,记录sdb2的UUID 目的是为了用UUID 做标识来启动操作系统,否则换了电脑硬盘标签变化就不能启动了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /boot/syslinux/syslinux.cfg</span><br></pre></td></tr></table></figure>
<p>修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># UI menu.c32 注释掉</span><br><span class="line">UI vesamenu.c32 取消注释</span><br></pre></td></tr></table></figure>
<p>把LABEL arch下面的root改成</p>
<blockquote>
<p>root&#x3D;UUID&#x3D;”****************************” rw<br>完成了这步,在你开机选这个U盘启动后应该就能出现syslinux的引导界面了,如果不行,请自行wiki换grub之类的</p>
</blockquote>
<h3 id="2-3新建用户"><a href="#2-3新建用户" class="headerlink" title="2.3新建用户"></a>2.3新建用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd </span><br></pre></td></tr></table></figure>
<p>先设置root用户的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S zsh</span><br></pre></td></tr></table></figure>
<h3 id="2-4安装zsh"><a href="#2-4安装zsh" class="headerlink" title="2.4安装zsh"></a>2.4安装zsh</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -m -g users -G wheel -s /bin/zsh ****</span><br></pre></td></tr></table></figure>
<p>创建一个名为****的用户,并使用zsh作默认shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd ****</span><br></pre></td></tr></table></figure>
<p>为****设置密码</p>
<h3 id="2-5添加root权限"><a href="#2-5添加root权限" class="headerlink" title="2.5添加root权限"></a>2.5添加root权限</h3><p>如果后面使用的时候出现不能sudo,提示is not in the sudoers file. This incident will be reported.<br>以root权限编辑 <code>/etc/sudoers</code>文件,在 <code>root ALL=(ALL) ALL</code>下面 加上 <code>[username] ALL=(ALL) ALL</code></p>
<p>也可以去掉<code>#%wheel ALL=(ALL) ALL</code>这一行前面的#</p>
<h3 id="2-6更新系统"><a href="#2-6更新系统" class="headerlink" title="2.6更新系统"></a>2.6更新系统</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman –Syu</span><br></pre></td></tr></table></figure>
<p>更新系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman-db-upgrade</span><br></pre></td></tr></table></figure>
<p>更新数据库</p>
<p>基本配置就结束了,下面是锦上添花</p>
<h3 id="2-7配置WIFI"><a href="#2-7配置WIFI" class="headerlink" title="2.7配置WIFI"></a>2.7配置WIFI</h3><p>把无线也写在这里吧,虚拟机中安装一般只会是有线状态,出问题也基本就是dhcp没获取到ip,手动重启一遍dhcp就会好</p>
<p>首先应该安装网卡驱动,ArchLinux在安装base-devel的时候一般都带着了,除非你的没有,那就要查一下资料自己装下了</p>
<p>首先需要安装无线相关的软件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S iw wpa_supplicant wireless_tools dialog networkmanager network-manager-applet</span><br><span class="line"></span><br><span class="line">systemctl enable NetworkManager</span><br></pre></td></tr></table></figure>
<p>这样就能开机自动启动网络配置。</p>
<h3 id="2-8安装声卡服务"><a href="#2-8安装声卡服务" class="headerlink" title="2.8安装声卡服务"></a>2.8安装声卡服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S alsa-utils</span><br></pre></td></tr></table></figure>
<p>官方说法叫解除静音</p>
<h3 id="2-9安装桌面系统"><a href="#2-9安装桌面系统" class="headerlink" title="2.9安装桌面系统"></a>2.9安装桌面系统</h3><p>请自行根据喜欢的桌面环境去安装配置,先装X</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xorg xorg-xinit</span><br></pre></td></tr></table></figure>
<h4 id="2-9-1安装KDE桌面环境"><a href="#2-9-1安装KDE桌面环境" class="headerlink" title="2.9.1安装KDE桌面环境"></a>2.9.1安装KDE桌面环境</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S plasma</span><br></pre></td></tr></table></figure>
<p>这就能把最新的plasma5安装上,同时会找到很多依赖包,其中就包括显卡驱动,NVIDIA的显卡请选择开源的驱动,也就是默认选择,不要作死(不要问我为什么知道T_T)</p>
<p>安装完KDE后,如果你这时候启动X,你会发现怎么没有终端,我们熟悉的终端呢？！对！就是没有,要自己装！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S konsole dolphin</span><br></pre></td></tr></table></figure>
<h4 id="2-9-2安装konsole和文件管理器"><a href="#2-9-2安装konsole和文件管理器" class="headerlink" title="2.9.2安装konsole和文件管理器"></a>2.9.2安装konsole和文件管理器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/X11/xinit/xinitrc ~/.xinitrc</span><br></pre></td></tr></table></figure>
<p>拷贝X的启动文件到用户目录,针对用户修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/.xinitrc</span><br></pre></td></tr></table></figure>
<p>把exec之前的都注释掉,把exec后面的改为startkde</p>
<h4 id="2-9-3安装GNOME桌面环境"><a href="#2-9-3安装GNOME桌面环境" class="headerlink" title="2.9.3安装GNOME桌面环境"></a>2.9.3安装GNOME桌面环境</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S gnome gnome-extra gdm</span><br></pre></td></tr></table></figure>
<p>将gdm设置为开机自启动，这样开机时会自动载入桌面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable gdm</span><br></pre></td></tr></table></figure>
<h4 id="2-9-4美化gnome"><a href="#2-9-4美化gnome" class="headerlink" title="2.9.4美化gnome"></a>2.9.4美化gnome</h4><p>20170826-update</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gnome-tweak-tool</span><br></pre></td></tr></table></figure>
<p>如果你安装了gnome-extra，那么这个工具已经被安装了，否则的话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S gnome-tweak-tool</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-1图标包"><a href="#2-9-4-1图标包" class="headerlink" title="2.9.4.1图标包"></a>2.9.4.1图标包</h5><p>这里我使用的numix-circle图标包，这个图标包在aur里，直接用yaourt即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yaourt -S numix-circle-icon-theme-git</span><br></pre></td></tr></table></figure>
<p>然后在gnome-tweak-tool里启用主题</p>
<h5 id="2-9-4-2主题"><a href="#2-9-4-2主题" class="headerlink" title="2.9.4.2主题"></a>2.9.4.2主题</h5><p>我们可以到下面这个网站上选自己喜欢的主体，安装方式也可以根据提示步骤来</p>
<p><a target="_blank" rel="noopener" href="https://www.gnome-look.org/">https://www.gnome-look.org/</a></p>
<p>然后在gnome-tweak-tool里启用</p>
<h5 id="2-9-4-3gdm背景"><a href="#2-9-4-3gdm背景" class="headerlink" title="2.9.4.3gdm背景"></a>2.9.4.3gdm背景</h5><p>输入以下指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -L -O http://archibold.io/sh/archibold</span><br><span class="line">chmod +x archibold</span><br><span class="line">./archibold login-backgroung 你的背景的地址</span><br></pre></td></tr></table></figure>
<p>重启后gdm就会变成你要的背景</p>
<h5 id="2-9-4-4gnome-shell拓展"><a href="#2-9-4-4gnome-shell拓展" class="headerlink" title="2.9.4.4gnome-shell拓展"></a>2.9.4.4gnome-shell拓展</h5><p>shell拓展请进入<a target="_blank" rel="noopener" href="https://extensions.gnome.org/%E8%87%AA%E8%A1%8C%E6%8C%89%E7%85%A7%E8%AF%B4%E6%98%8E%E5%AE%89%E8%A3%85">https://extensions.gnome.org/自行按照说明安装</a></p>
<h5 id="2-9-4-5screenfetch"><a href="#2-9-4-5screenfetch" class="headerlink" title="2.9.4.5screenfetch"></a>2.9.4.5screenfetch</h5><p>screenfetch可以在终端里输出你的系统logo和状态。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S screenfetch</span><br></pre></td></tr></table></figure>
<p>要让screenfetch在打开终端是自动输出，在<code>~/.zshrc</code>里加入</p>
<p>最后<br><code>exit</code>然后<code>umount -R /mnt</code>关掉虚拟机,拔下U盘,去嗨吧</p>
<p>20160423-update</p>
<h5 id="2-9-4-6安装必要字体"><a href="#2-9-4-6安装必要字体" class="headerlink" title="2.9.4.6安装必要字体"></a>2.9.4.6安装必要字体</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S ttf-dejavu wqy-zenhei wqy-microhei</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-7安装火狐"><a href="#2-9-4-7安装火狐" class="headerlink" title="2.9.4.7安装火狐"></a>2.9.4.7安装火狐</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S firefox</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-8安装net-tools（包含ifconfig）"><a href="#2-9-4-8安装net-tools（包含ifconfig）" class="headerlink" title="2.9.4.8安装net-tools（包含ifconfig）"></a>2.9.4.8安装net-tools（包含ifconfig）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S net-tools</span><br></pre></td></tr></table></figure>
<p>修改<code>/boot/syslinux/syslinux.cfg</code></p>
<blockquote>
<p>timeout &#x3D; 0<br>注销所有菜单选项</p>
</blockquote>
<h5 id="2-9-4-9启动sddm"><a href="#2-9-4-9启动sddm" class="headerlink" title="2.9.4.9启动sddm"></a>2.9.4.9启动sddm</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable sddm.service</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-10安装wget，git"><a href="#2-9-4-10安装wget，git" class="headerlink" title="2.9.4.10安装wget，git"></a>2.9.4.10安装wget，git</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacamn -S wget git</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-11安装oh-my-zsh"><a href="#2-9-4-11安装oh-my-zsh" class="headerlink" title="2.9.4.11安装oh-my-zsh"></a>2.9.4.11安装oh-my-zsh</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-12安装Yaourt"><a href="#2-9-4-12安装Yaourt" class="headerlink" title="2.9.4.12安装Yaourt"></a>2.9.4.12安装Yaourt</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone https://aur.archlinux.org/package-query.git</span><br><span class="line">cd package-query</span><br><span class="line">makepkg -si</span><br><span class="line">cd ..</span><br><span class="line">git clone https://aur.archlinux.org/yaourt.git</span><br><span class="line">cd yaourt</span><br><span class="line">makepkg -si</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure>

<p>更新yaourt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yaourt -Syu --devel --aur</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-13安装搜狗中文输入法"><a href="#2-9-4-13安装搜狗中文输入法" class="headerlink" title="2.9.4.13安装搜狗中文输入法"></a>2.9.4.13安装搜狗中文输入法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yaourt -S fcitx-sogoupinyin</span><br></pre></td></tr></table></figure>
<p>由于设置的输出是UTF-8，所以终端中不做设置可能会显示为乱码，我们设置下nano ~&#x2F;.zshrc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export LC_ALL=en_US.UTF-8  </span><br><span class="line">export LANG=en_US.UTF-8</span><br></pre></td></tr></table></figure>
<p>20170826-update</p>
<h5 id="2-9-4-14安装chrome"><a href="#2-9-4-14安装chrome" class="headerlink" title="2.9.4.14安装chrome"></a>2.9.4.14安装chrome</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yaourt -S google-chrome</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-15解压软件"><a href="#2-9-4-15解压软件" class="headerlink" title="2.9.4.15解压软件"></a>2.9.4.15解压软件</h5><p>需要图形化的解压软件可以这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S p7zip file-roller unrar</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-16文件系统支持"><a href="#2-9-4-16文件系统支持" class="headerlink" title="2.9.4.16文件系统支持"></a>2.9.4.16文件系统支持</h5><p>要支持制作fat文件系统，安装dosfstools，默认内核只能读取ntfs，要支持ntfs读写，安装ntfs-3g。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S ntfs-3g dosfstools</span><br></pre></td></tr></table></figure>
<h5 id="2-9-4-17无线AP"><a href="#2-9-4-17无线AP" class="headerlink" title="2.9.4.17无线AP"></a>2.9.4.17无线AP</h5><p>需要安装create-ap才能使用gnome3设置里的创建热点选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S create_ap</span><br></pre></td></tr></table></figure>
        </div>
        <div class="post-reply">
            
            
        </div>
    </div>
</section>
<script>
    // 获取第一张图, 用以当封面背景图
    var img = document.querySelectorAll('img')[1]

    if (img) {
        var header_box = document.querySelector('#header_box')
        header_box.style.backgroundImage = 'url('+ img.src +')'
    }
</script>

<!-- for code block highlight --> 
<!-- theme.block_highlight -->
<!-- we do not guarantee the char sequences spell right, usr himself do it -->

<link rel="stylesheet" href="/css/highlight_rainbow.css">

<script src="/js/highlight.min.js"></script>
<script type="text/javascript"> hljs.initHighlightingOnLoad();</script>

  <div class="comment" style="width:70%; min-height: 80vh;margin: 0 auto;"></div>
    <script>
        new Valine({
            av: AV, 
            el: '.comment', 
            app_id: '', 
            app_key: '',
            placeholder: '随便写点什么吧~~'
        });
    </script>

      </div>
  </div>
  <style>
  #footer {
    min-height: 10vh;
    background: black;
    color: #fff;
  }

  #footer a {
    color: #e1e1e1;
  }
</style>
<footer id="footer" class="has-text-centered is-flex center">
  <div class="container has-padding">
    <div>
      <div>
        <!--请您保留作者署名, 主题制作来之不易-->
        My Theme <a target="_blank" rel="noopener" href="https://github.com/DraceWang/hexo-theme-Hexagon/">Hexagon</a>
        Base on <a target="_blank" rel="noopener" href="https://haojen.github.io/Claudia-theme-blog/">Claudia</a> Theme By <a target="_blank" rel="noopener" href="https://haojen.github.io/">Haojen Ma</a>
        <br>
        Copyright © Drace Wang 2023
        <br>
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      </div>
    </div>
  </div>
</footer>


<script src="/js/search_core.js"></script>


<script src="/js/script.js"></script>


  <script type="text/javascript" color=3,232,253   pointColor=3,232,253  opacity=0.85  count=100  src="/js/canvas-nest.js"></script>

</body>
</html>